<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Subtitle Conversion & Shifting Tools</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    
    <main>
        <section class="tool-card">
            <h2>SRT to VTT Converter</h2>
            <p class="instructions">Upload an **.srt** file. It will be converted to the VTT format with the same base filename.</p>
            
            <form id="converter-form" class="upload-form">
                <input type="file" id="srt-input" accept=".srt" required>
                <button type="submit">Convert and Download</button>
            </form>
            <div id="converter-message" class="result-message"></div>
        </section>

        <hr>

        <section class="tool-card">
            <h2>VTT Timing Shifter</h2>
            <p class="instructions">Upload a **.vtt** file. All cue timings will be shifted forward by **6 seconds**.</p>
            
            <form id="shifter-form" class="upload-form">
                <input type="file" id="vtt-input" accept=".vtt" required>
                <button type="submit">Shift and Download</button>
            </form>
            <div id="shifter-message" class="result-message"></div>
        </section>
    </main>

    <footer>
        <p>Subtitle Tools built with HTML and JavaScript for GitHub Pages deployment.</p>
    </footer>

    <script>
        // --- Core Utility Functions ---

        /**
         * Initiates a file download in the browser.
         */
        function downloadFile(fileName, content, mimeType = 'text/vtt') {
            const blob = new Blob([content], { type: mimeType });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            
            a.href = url;
            a.download = fileName;
            
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            
            URL.revokeObjectURL(url);
        }

        // --- CONVERTER TOOL LOGIC ---

        function srtToVtt(srtContent) {
            let vttContent = "WEBVTT\n\n";
            const blocks = srtContent.trim().split(/\r?\n\r?\n/);

            blocks.forEach(block => {
                const lines = block.trim().split(/\r?\n/);
                
                if (lines.length > 1 && lines[1].includes('-->')) {
                    let timing = lines[1].replace(/,/g, '.');
                    const text = lines.slice(2).join('\n');
                    vttContent += `${timing}\n${text}\n\n`;
                }
            });
            
            return vttContent.trim();
        }

        // --- SHIFTER TOOL LOGIC ---
        
        const SIX_SECONDS_MS = 6000;

        function timeToMs(timeStr) {
            const [h, m, sMs] = timeStr.split(':').map(s => s.trim());
            const [s, ms] = sMs.split('.');
            
            return (
                (parseInt(h) * 3600 + parseInt(m) * 60 + parseInt(s)) * 1000 + 
                parseInt(ms)
            );
        }

        function msToTime(totalMs) {
            if (totalMs < 0) totalMs = 0;
            
            const ms = totalMs % 1000;
            let totalSeconds = Math.floor(totalMs / 1000);
            
            const s = totalSeconds % 60;
            totalSeconds = Math.floor(totalSeconds / 60);
            
            const m = totalSeconds % 60;
            const h = Math.floor(totalSeconds / 60);
            
            const format = val => String(val).padStart(2, '0');
            const msFormat = val => String(val).padStart(3, '0');
            
            return `${format(h)}:${format(m)}:${format(s)}.${msFormat(ms)}`;
        }

        function shiftVtt(vttContent) {
            const lines = vttContent.split(/\r?\n/);
            let newLines = [];
            
            lines.forEach(line => {
                if (line.includes('-->')) {
                    const lineParts = line.split(' ');
                    // Assuming standard format: [START] [-->] [END] [METADATA...]
                    const timingStr = lineParts[0] + ' ' + lineParts[1] + ' ' + lineParts[2];
                    const metadata = lineParts.slice(3).join(' ');
                    
                    const [startStr, , endStr] = timingStr.split(' ');

                    const startMs = timeToMs(startStr.trim());
                    const newStartStr = msToTime(startMs + SIX_SECONDS_MS);
                    
                    const endMs = timeToMs(endStr.trim());
                    const newEndStr = msToTime(endMs + SIX_SECONDS_MS);
                    
                    newLines.push(`${newStartStr} --> ${newEndStr} ${metadata}`.trim());
                } else {
                    newLines.push(line);
                }
            });
            
            return newLines.join('\n');
        }


        // --- Event Handlers ---

        document.getElementById('converter-form').addEventListener('submit', function(e) {
            e.preventDefault();
            const fileInput = document.getElementById('srt-input');
            const messageDiv = document.getElementById('converter-message');
            messageDiv.style.display = 'none';

            if (fileInput.files.length === 0) return;

            const file = fileInput.files[0];
            const reader = new FileReader();

            reader.onload = function(event) {
                try {
                    const srtContent = event.target.result;
                    const vttContent = srtToVtt(srtContent);
                    
                    const baseName = file.name.replace(/\.[^/.]+$/, "");
                    const newFileName = baseName + ".vtt";
                    
                    downloadFile(newFileName, vttContent);
                    
                    messageDiv.textContent = `Conversion successful! Downloading "${newFileName}".`;
                    messageDiv.style.display = 'block';

                } catch (error) {
                    messageDiv.textContent = `Error converting file: ${error.message}`;
                    messageDiv.style.display = 'block';
                }
            };
            
            reader.readAsText(file, 'utf-8');
        });

        document.getElementById('shifter-form').addEventListener('submit', function(e) {
            e.preventDefault();
            const fileInput = document.getElementById('vtt-input');
            const messageDiv = document.getElementById('shifter-message');
            messageDiv.style.display = 'none';

            if (fileInput.files.length === 0) return;

            const file = fileInput.files[0];
            const reader = new FileReader();

            reader.onload = function(event) {
                try {
                    const vttContent = event.target.result;
                    const shiftedContent = shiftVtt(vttContent);
                    
                    const baseName = file.name.replace(/\.[^/.]+$/, "");
                    const newFileName = baseName + "_shifted.vtt";
                    
                    downloadFile(newFileName, shiftedContent);
                    
                    messageDiv.textContent = `Shift successful (+6 seconds)! Downloading "${newFileName}".`;
                    messageDiv.style.display = 'block';

                } catch (error) {
                    messageDiv.textContent = `Error shifting timings: ${error.message}`;
                    messageDiv.style.display = 'block';
                }
            };
            
            reader.readAsText(file, 'utf-8');
        });

    </script>
</body>
</html>
